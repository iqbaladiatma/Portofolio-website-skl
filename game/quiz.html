<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduGame: Pusat Game Edukasi AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
    <style>
      body {
        font-family: "Press Start 2P", cursive;
        background-color: #5c94fc; /* Mario sky blue */
        background-image: url('https://www.transparenttextures.com/patterns/cubes.png');
        color: #ffffff;
      }
      .font-body { font-family: "Poppins", sans-serif; }
      .card {
        background-color: #d97706; /* Brick color */
        border: 4px solid #000000;
        border-radius: 8px;
        box-shadow: inset -4px -4px 0px 0px #874805;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .card:hover:not(.non-interactive) { transform: translateY(-6px) scale(1.02); }
      .btn {
        font-family: "Press Start 2P", cursive;
        transition: all 0.2s ease;
        text-transform: uppercase;
        border-radius: 8px;
        border: 4px solid #000000;
        box-shadow: inset -4px -4px 0px 0px rgba(0,0,0,0.2);
        padding: 12px 20px;
      }
      .btn:disabled { opacity: 0.5; cursor: not-allowed; }
      .btn:active:not(:disabled) { transform: translateY(2px); box-shadow: inset -2px -2px 0px 0px rgba(0,0,0,0.2); }
      .btn-primary { background-color: #22c55e; color: white; } /* Green */
      .btn-danger { background-color: #ef4444; color: white; } /* Red */
      .btn-secondary { background-color: #3b82f6; color: white; } /* Blue */
      .btn-warning { background-color: #f59e0b; color: white; } /* Amber */
      #loading-spinner { border: 4px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: #f9a825; width: 50px; height: 50px; animation: spin 1s ease-in-out infinite; }
      @keyframes spin { to { transform: rotate(360deg); } }
      .modal-backdrop { background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); }
      .screen { width: 100%; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 1rem; }
      .text-shadow { text-shadow: 3px 3px 0px #000000; }
      .progress-bar-container { background-color: #000; border-radius: 9999px; overflow: hidden; border: 4px solid black; }
      .progress-bar { background: linear-gradient(to right, #facc15, #fb923c, #ef4444); height: 100%; transition: width 0.2s linear; }
    </style>
  </head>
  <body class="antialiased">
    <div id="app" class="container mx-auto min-h-screen flex flex-col items-center justify-center">
      <!-- Universal Loading Screen -->
      <div id="loading-screen" class="fixed inset-0 z-50 flex-col items-center justify-center modal-backdrop hidden">
        <div id="loading-spinner"></div>
        <p id="loading-text" class="mt-4 text-xl">Memuat...</p>
      </div>

      <!-- Profile Modal -->
       <div id="profile-modal" class="fixed inset-0 z-40 flex-col items-center justify-center modal-backdrop hidden">
        <div class="card non-interactive rounded-lg p-8 w-full max-w-lg text-center max-h-[90vh] flex flex-col">
          <h2 class="text-3xl text-shadow mb-2 text-white">Profil</h2>
          <p class="mb-2 font-body">Total Poin: <span id="profile-points" class="font-bold">0</span></p>
          <p class="font-body text-xs mb-4">User ID: <span id="profile-uid" class="break-all"></span></p>
          <div id="edit-profile-section" class="font-body">
            <p class="mb-2 font-semibold">Ubah Nama Tampilan</p>
            <input type="text" id="edit-username-input" class="w-full text-black border-4 border-black rounded-lg p-3 text-center">
            <button id="save-profile-btn" class="w-full btn btn-primary mt-2">Simpan</button>
          </div>
          <hr class="my-6 border-black border-2">
          <h3 class="text-xl mb-4">Riwayat Permainan</h3>
          <div id="game-history-list" class="flex-grow overflow-y-auto space-y-3 text-left font-body">
            <p>Tidak ada riwayat permainan.</p>
          </div>
          <hr class="my-6 border-black border-2">
          <div class="flex space-x-4">
              <button id="logout-btn" class="w-full btn btn-danger">Logout</button>
              <button id="close-profile-btn" class="w-full btn btn-secondary">Tutup</button>
          </div>
        </div>
      </div>

      <!-- Auth Screen (Login/Register) -->
      <div id="auth-screen" class="screen w-full max-w-md text-center">
        <h1 class="text-5xl text-shadow text-white mb-4">EduGame</h1>
        <div class="card non-interactive rounded-lg p-6 w-full font-body">
            <div class="flex border-b-4 border-black mb-4">
                <button id="show-login-tab" class="flex-1 font-bold py-2 border-b-8 border-yellow-400">Login</button>
                <button id="show-register-tab" class="flex-1 font-bold py-2 text-gray-300">Register</button>
            </div>
            <!-- Login Form -->
            <form id="login-form" class="space-y-4">
                <input type="text" id="login-username" placeholder="Username" required class="w-full text-black border-4 border-black rounded-lg p-3 text-center">
                <input type="password" id="login-password" placeholder="Password" required class="w-full text-black border-4 border-black rounded-lg p-3 text-center">
                <button type="submit" class="w-full btn btn-primary">Login</button>
            </form>
            <!-- Register Form -->
            <form id="register-form" class="space-y-4 hidden">
                <input type="text" id="register-username" placeholder="Username (tanpa spasi)" required class="w-full text-black border-4 border-black rounded-lg p-3 text-center">
                <input type="password" id="register-password" placeholder="Password (min. 6 karakter)" required class="w-full text-black border-4 border-black rounded-lg p-3 text-center">
                <button type="submit" class="w-full btn btn-primary">Register</button>
            </form>
            <p id="auth-error" class="text-yellow-300 font-bold mt-4 h-5"></p>
        </div>
      </div>

      <!-- Main Menu Screen -->
      <div id="main-menu-screen" class="screen w-full max-w-7xl">
        <div class="w-full flex justify-between items-center mb-4 px-2">
            <div>
                <button id="admin-panel-btn" class="btn btn-danger py-2 px-3 text-xs hidden">Admin</button>
            </div>
            <div>
                <button id="global-chat-btn" class="btn btn-warning py-2 px-3 text-xs">Chat</button>
                <button id="profile-btn" class="btn btn-secondary py-2 px-3 text-xs ml-2">Profil</button>
            </div>
        </div>
        <h1 class="text-5xl text-shadow text-white mb-2">EduGame</h1>
        <p class="text-lg mb-8 font-body">Selamat datang, <span id="username-display" class="font-bold text-yellow-300"></span>!</p>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 w-full">
            <!-- Game Cards Section -->
            <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-8">
                <div id="start-perang-sastra" class="card rounded-lg p-6 cursor-pointer flex flex-col items-center"><h2 class="text-2xl mb-2">Perang Sastra</h2><p class="font-body text-sm text-center">Adu kreativitas sastra melawan teman atau AI.</p></div>
                <div id="start-menguji-literasi" class="card rounded-lg p-6 cursor-pointer flex flex-col items-center"><h2 class="text-2xl mb-2">Uji Literasi</h2><p class="font-body text-sm text-center">Asah pemahaman kosakatamu.</p></div>
                <div id="start-kuis-sosial" class="card rounded-lg p-6 cursor-pointer flex flex-col items-center"><h2 class="text-2xl mb-2">Kuis Sosial</h2><p class="font-body text-sm text-center">Uji wawasan sosial dan umum.</p></div>
                <div id="start-berkarya" class="card rounded-lg p-6 cursor-pointer flex flex-col items-center"><h2 class="text-2xl mb-2">Berkarya</h2><p class="font-body text-sm text-center">Tulis karya dan dapatkan masukan AI.</p></div>
                <div id="start-fix-code" class="card rounded-lg p-6 cursor-pointer flex flex-col items-center"><h2 class="text-2xl mb-2">Fix the Code</h2><p class="font-body text-sm text-center">Perbaiki kode yang rusak.</p></div>
                <div id="start-custom-quiz" class="card rounded-lg p-6 cursor-pointer flex flex-col items-center"><h2 class="text-2xl mb-2">Kuis Kustom</h2><p class="font-body text-sm text-center">Mainkan kuis buatan admin!</p></div>
            </div>

            <!-- Leaderboard Section -->
            <div id="leaderboard-container" class="lg:col-span-1 w-full">
                <h2 class="text-3xl text-shadow text-white mb-4 text-center">Leaderboard</h2>
                <div id="leaderboard-list" class="card non-interactive rounded-lg p-6 w-full space-y-3 max-h-[60vh] overflow-y-auto">
                    <!-- Leaderboard content will be injected here -->
                </div>
            </div>
        </div>
      </div>

      <!-- Admin Panel Screen -->
      <div id="admin-panel-screen" class="screen w-full max-w-6xl">
          <h1 class="text-3xl text-shadow text-white mb-6">Admin Dashboard</h1>
          <div class="w-full grid grid-cols-1 lg:grid-cols-3 gap-8 font-body">
              <!-- User Management -->
              <div class="card non-interactive p-6 lg:col-span-1">
                  <h2 class="text-2xl mb-4">Pengguna</h2>
                  <div id="admin-user-list" class="space-y-2 max-h-96 overflow-y-auto"></div>
              </div>
              <!-- Content Management -->
              <div class="card non-interactive p-6 lg:col-span-2 space-y-6">
                  <div>
                      <h2 class="text-2xl mb-4">Kirim Hadiah Poin</h2>
                      <form id="send-gift-form" class="space-y-2">
                          <input type="text" id="gift-uid" placeholder="User ID Penerima" class="w-full text-black border-4 border-black rounded-lg p-3">
                          <input type="number" id="gift-points" placeholder="Jumlah Poin" class="w-full text-black border-4 border-black rounded-lg p-3">
                          <button type="submit" class="w-full btn btn-primary">Kirim</button>
                      </form>
                  </div>
                   <div>
                      <h2 class="text-2xl mb-4">Buat Kuis Kustom</h2>
                      <form id="create-quiz-form" class="space-y-2">
                          <input type="text" id="quiz-title" placeholder="Judul Kuis" class="w-full text-black border-4 border-black rounded-lg p-3">
                          <input type="text" id="quiz-id" placeholder="ID Kuis (e.g., sejarah-dunia)" class="w-full text-black border-4 border-black rounded-lg p-3">
                          <textarea id="quiz-questions" rows="6" class="w-full text-black border-4 border-black rounded-lg p-3" placeholder="Pertanyaan;;OpsiA;;OpsiB;;OpsiC;;OpsiD;;JawabanBenar (satu per baris)"></textarea>
                          <button type="submit" class="w-full btn btn-primary">Simpan Kuis</button>
                      </form>
                  </div>
              </div>
          </div>
          <button class="back-to-menu-btn mt-8 text-yellow-300 hover:text-yellow-100 font-semibold">&larr; Kembali ke Menu</button>
      </div>
      
      <!-- Global Chat Modal -->
      <div id="global-chat-modal" class="fixed inset-0 z-40 flex-col items-center justify-center modal-backdrop hidden">
        <div class="card non-interactive rounded-lg p-4 w-full max-w-lg h-[80vh] flex flex-col font-body">
            <h2 class="text-2xl text-center mb-4">Global Chat</h2>
            <div id="chat-messages" class="flex-grow bg-black bg-opacity-30 rounded-lg p-4 overflow-y-auto space-y-4">
                <!-- Messages will be injected here -->
            </div>
            <form id="chat-form" class="mt-4 flex space-x-2">
                <input type="text" id="chat-input" class="w-full text-black border-4 border-black rounded-lg p-3" placeholder="Ketik pesan...">
                <button type="submit" class="btn btn-primary px-4">Kirim</button>
            </form>
            <button id="close-chat-btn" class="w-full btn btn-secondary mt-2">Tutup</button>
        </div>
      </div>

      <!-- Quiz Mode Selection Modal -->
      <div id="quiz-mode-modal" class="fixed inset-0 z-40 flex-col items-center justify-center modal-backdrop hidden">
        <div class="card non-interactive rounded-lg p-8 w-full max-w-md text-center">
          <h2 id="quiz-mode-title" class="text-3xl text-shadow text-white mb-6">Pilih Mode</h2>
          <div class="space-y-4">
            <button id="quiz-mode-sp" class="w-full btn btn-primary">Single Player</button>
            <button id="quiz-mode-mp" class="w-full btn btn-secondary">Multiplayer</button>
          </div>
          <button id="back-from-quiz-mode" class="mt-6 text-yellow-300 hover:text-yellow-100 font-semibold">&larr; Kembali</button>
        </div>
      </div>

      <!-- Quiz Multiplayer Lobby -->
      <div id="quiz-mp-lobby-screen" class="screen w-full max-w-md text-center">
        <h1 id="quiz-lobby-title" class="text-3xl text-shadow text-white mb-6">Lobi Kuis</h1>
        <div class="card non-interactive rounded-lg p-8 space-y-4 w-full">
          <button id="create-quiz-room-btn" class="w-full btn btn-primary">Buat Room Baru</button>
          <div class="relative flex items-center"><div class="flex-grow border-t-4 border-black"></div><span class="flex-shrink mx-4 font-body">atau</span><div class="flex-grow border-t-4 border-black"></div></div>
          <div class="font-body">
            <input type="text" id="join-quiz-code-input" placeholder="Masukkan Kode Room" class="w-full text-black border-4 border-black rounded-lg p-3 text-center mt-4" />
            <button id="join-quiz-room-btn" class="w-full btn btn-secondary mt-2">Gabung Room</button>
          </div>
        </div>
        <button class="back-to-menu-btn mt-8 text-yellow-300 hover:text-yellow-100 font-semibold">&larr; Kembali ke Menu</button>
        <p id="quiz-lobby-error" class="text-yellow-300 font-bold mt-4 h-5"></p>
      </div>

      <!-- Perang Sastra Lobby -->
      <div id="perang-sastra-lobby-screen" class="screen w-full max-w-md text-center">
        <h1 class="text-3xl text-shadow text-white mb-6">Lobi Perang Sastra</h1>
        <div class="card non-interactive rounded-lg p-8 space-y-4 w-full">
          <button id="single-player-sastra-btn" class="w-full btn btn-primary">Lawan AI</button>
          <div class="relative flex items-center"><div class="flex-grow border-t-4 border-black"></div><span class="flex-shrink mx-4 font-body">atau</span><div class="flex-grow border-t-4 border-black"></div></div>
          <div class="font-body">
            <button id="create-game-btn" class="w-full btn btn-secondary">Buat Room Baru</button>
            <input type="text" id="join-game-input" placeholder="Masukkan ID Room" class="w-full text-black border-4 border-black rounded-lg p-3 text-center mt-4" />
            <button id="join-game-btn" class="w-full btn btn-secondary mt-2">Gabung Room</button>
          </div>
        </div>
        <button class="back-to-menu-btn mt-8 text-yellow-300 hover:text-yellow-100 font-semibold">&larr; Kembali ke Menu</button>
        <p id="lobby-error" class="text-yellow-300 font-bold mt-4 h-5"></p>
      </div>

      <!-- Language Selection Modal -->
      <div id="language-selection-modal" class="fixed inset-0 z-40 flex-col items-center justify-center modal-backdrop hidden">
        <div class="card non-interactive rounded-lg p-8 w-full max-w-md text-center">
          <h2 class="text-3xl text-shadow text-white mb-6">Pilih Bahasa</h2>
          <div class="space-y-4">
            <button data-lang="JavaScript" class="lang-btn w-full btn btn-secondary">JavaScript</button>
            <button data-lang="Python" class="lang-btn w-full btn btn-secondary">Python</button>
            <button data-lang="Java" class="lang-btn w-full btn btn-secondary">Java</button>
            <button data-lang="C++" class="lang-btn w-full btn btn-secondary">C++</button>
          </div>
          <button id="back-from-lang" class="mt-6 text-yellow-300 hover:text-yellow-100 font-semibold">&larr; Kembali</button>
        </div>
      </div>
      
      <!-- Level Selection Modal -->
      <div id="level-selection-modal" class="fixed inset-0 z-40 flex-col items-center justify-center modal-backdrop hidden">
        <div class="card non-interactive rounded-lg p-8 w-full max-w-md text-center">
          <h2 id="level-title" class="text-3xl text-shadow text-white mb-6">Pilih Level</h2>
          <div class="space-y-4">
            <button data-level="mudah" class="level-btn w-full btn btn-secondary">Mudah</button>
            <button data-level="sedang" class="level-btn w-full btn btn-secondary">Sedang</button>
            <button data-level="sulit" class="level-btn w-full btn btn-secondary">Sulit</button>
          </div>
          <button id="back-from-level" class="mt-6 text-yellow-300 hover:text-yellow-100 font-semibold">&larr; Kembali</button>
        </div>
      </div>
      
      <!-- Game Container Screen -->
      <div id="game-container-screen" class="screen w-full max-w-5xl">
        <div id="game-content" class="w-full flex justify-center"></div>
      </div>
      
      <!-- Custom Quiz Lobby Screen -->
      <div id="custom-quiz-lobby-screen" class="screen w-full max-w-2xl">
        <h1 class="text-3xl text-shadow text-white mb-6">Pilih Kuis Kustom</h1>
        <div id="custom-quiz-list" class="card non-interactive rounded-lg p-6 w-full space-y-3">
            <p class="text-center">Memuat daftar kuis...</p>
        </div>
        <button class="back-to-menu-btn mt-8 text-yellow-300 hover:text-yellow-100 font-semibold">&larr; Kembali ke Menu</button>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
      import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, arrayUnion, collection, getDocs, deleteDoc, addDoc, serverTimestamp, query, orderBy, increment, limit, where, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      // --- KONFIGURASI FIREBASE & ADMIN ---
      const firebaseConfig = {
        apiKey: "AIzaSyDmkan5Fl3lWEc6evh52jooQ7ND5D9B0hM",
        authDomain: "edugame-saya.firebaseapp.com",
        projectId: "edugame-saya",
        storageBucket: "edugame-saya.firebasestorage.app",
        messagingSenderId: "563777542851",
        appId: "1:563777542851:web:607dff8876ceb576b2e076",
      };

      const ADMIN_UIDS = ["sklDKZpTjtXHyxRyHWCG64uQB4g1"]; // Bisa diisi lebih dari satu: ["UID1", "UID2"]
      const GEMINI_API_KEY = "  AIzaSyBololuFiiLZZEJlWxFaO-G4WWwb_c0jbA";
      
      const appId = "edugame-ai-local";

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      let currentUser = null;
      let userData = null;
      let unsubscribeGameListener = null;
      let unsubscribeChat = null;
      let currentQuizType = null;
      let quizTimerId = null;
      let selectedCodeLanguage = null;
      let currentQuizInfo = {};

      // --- UI ELEMENTS ---
      const screens = {
        loading: document.getElementById("loading-screen"),
        profileModal: document.getElementById("profile-modal"),
        auth: document.getElementById("auth-screen"),
        mainMenu: document.getElementById("main-menu-screen"),
        perangSastraLobby: document.getElementById("perang-sastra-lobby-screen"),
        levelSelection: document.getElementById("level-selection-modal"),
        languageSelection: document.getElementById("language-selection-modal"),
        gameContainer: document.getElementById("game-container-screen"),
        adminPanel: document.getElementById("admin-panel-screen"),
        globalChatModal: document.getElementById('global-chat-modal'),
        quizModeModal: document.getElementById('quiz-mode-modal'),
        quizMpLobby: document.getElementById('quiz-mp-lobby-screen'),
        customQuizLobby: document.getElementById('custom-quiz-lobby-screen'),
      };
      
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const authError = document.getElementById('auth-error');
      const adminPanelBtn = document.getElementById("admin-panel-btn");
      const usernameDisplay = document.getElementById("username-display");
      const gameContent = document.getElementById("game-content");

      // --- AUTH & USER SETUP ---
      onAuthStateChanged(auth, async (user) => {
        showLoading(true, 'Memverifikasi...');
        if (user) {
          currentUser = user;
          const userDocRef = doc(db, "users", user.uid);
          const userDocSnap = await getDoc(userDocRef);
          if (userDocSnap.exists()) {
            userData = userDocSnap.data();
            if (userData.isBanned) {
                alert("Akun Anda telah dibanned.");
                await signOut(auth);
                showLoading(false);
                return;
            }
            usernameDisplay.textContent = userData.displayName;
            adminPanelBtn.classList.toggle('hidden', !ADMIN_UIDS.includes(user.uid));
            showScreen("mainMenu");
            renderLeaderboard('leaderboard-list');
          } else {
             await signOut(auth);
          }
        } else {
          currentUser = null;
          userData = null;
          showScreen("auth");
        }
        showLoading(false);
      });

      // --- AUTH FORM LOGIC (USERNAME/PASSWORD) ---
      document.getElementById('show-login-tab').addEventListener('click', (e) => {
          loginForm.classList.remove('hidden');
          registerForm.classList.add('hidden');
          e.target.classList.add('border-yellow-400');
          e.target.classList.remove('text-gray-300');
          const registerTab = document.getElementById('show-register-tab');
          registerTab.classList.remove('border-yellow-400');
          registerTab.classList.add('text-gray-300');
          authError.textContent = '';
      });
      document.getElementById('show-register-tab').addEventListener('click', (e) => {
          loginForm.classList.add('hidden');
          registerForm.classList.remove('hidden');
          e.target.classList.add('border-yellow-400');
          e.target.classList.remove('text-gray-300');
          const loginTab = document.getElementById('show-login-tab');
          loginTab.classList.remove('border-yellow-400');
          loginTab.classList.add('text-gray-300');
          authError.textContent = '';
      });

      loginForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          showLoading(true, 'Mencari pengguna...');
          const username = document.getElementById('login-username').value;
          const password = document.getElementById('login-password').value;
          
          try {
              const usersRef = collection(db, "users");
              const q = query(usersRef, where("displayName", "==", username));
              const querySnapshot = await getDocs(q);

              if (querySnapshot.empty) {
                  throw new Error("auth/user-not-found");
              }

              const userDoc = querySnapshot.docs[0].data();
              const email = userDoc.email;

              showLoading(true, 'Logging in...');
              await signInWithEmailAndPassword(auth, email, password);

          } catch (error) {
              authError.textContent = getAuthErrorMessage(error.code || error.message);
          } finally {
              showLoading(false);
          }
      });

      registerForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          showLoading(true, 'Mendaftarkan...');
          const displayName = document.getElementById('register-username').value.trim();
          const email = document.getElementById('register-email').value;
          const password = document.getElementById('register-password').value;
          
          if(displayName.length < 3 || displayName.includes(" ")) {
              authError.textContent = "Username minimal 3 karakter & tanpa spasi.";
              showLoading(false);
              return;
          }

          try {
              // Check if username already exists
              const usersRef = collection(db, "users");
              const q = query(usersRef, where("displayName", "==", displayName));
              const querySnapshot = await getDocs(q);
              if (!querySnapshot.empty) {
                  throw new Error("auth/username-already-in-use");
              }

              const userCredential = await createUserWithEmailAndPassword(auth, email, password);
              const user = userCredential.user;
              await setDoc(doc(db, "users", user.uid), {
                  uid: user.uid,
                  displayName: displayName,
                  email: user.email,
                  totalPoints: 0,
                  isBanned: false,
                  createdAt: serverTimestamp()
              });
          } catch (error) {
              authError.textContent = getAuthErrorMessage(error.code || error.message);
          } finally {
              showLoading(false);
          }
      });
      
      document.getElementById('logout-btn').addEventListener('click', async () => {
          await signOut(auth);
          screens.profileModal.style.display = 'none';
      });
      
      function getAuthErrorMessage(code) {
          switch (code) {
              case 'auth/wrong-password': return 'Password salah.';
              case 'auth/user-not-found': return 'Username tidak ditemukan.';
              case 'auth/email-already-in-use': return 'Email ini sudah digunakan.';
              case 'auth/username-already-in-use': return 'Username ini sudah digunakan.';
              case 'auth/weak-password': return 'Password minimal 6 karakter.';
              default: return 'Terjadi kesalahan. Coba lagi.';
          }
      }

      // --- PROFILE MODAL LOGIC ---
      document.getElementById('profile-btn').addEventListener('click', async () => {
          document.getElementById('edit-username-input').value = userData.displayName;
          document.getElementById('profile-points').textContent = userData.totalPoints || 0;
          document.getElementById('profile-uid').textContent = currentUser.uid;
          const historyList = document.getElementById('game-history-list');
          historyList.innerHTML = '<p>Memuat riwayat...</p>';
          screens.profileModal.style.display = 'flex';

          const historyRef = collection(db, `users/${currentUser.uid}/gameHistory`);
          const q = query(historyRef, orderBy("timestamp", "desc"), limit(10));
          const querySnapshot = await getDocs(q);
          
          if (querySnapshot.empty) {
              historyList.innerHTML = '<p>Tidak ada riwayat permainan.</p>';
          } else {
              historyList.innerHTML = '';
              querySnapshot.forEach(docSnap => {
                  const history = docSnap.data();
                  const historyCard = document.createElement('div');
                  historyCard.className = 'bg-blue-800 p-3 rounded-lg';
                  let content = '';
                  if (history.type === 'Kuis') {
                      content = `<p class="font-bold">${history.title} (${history.difficulty})</p><p>Skor: ${history.score}/${history.total} (+${history.pointsEarned} Poin)</p>`;
                  } else if (history.type === 'Berkarya') {
                      content = `<p class="font-bold">Berkarya: ${history.prompt}</p><p class="italic text-sm text-gray-300">Anda mendapat masukan dari AI.</p>`;
                  } else if (history.type === 'FixTheCode') {
                      content = `<p class="font-bold">Fix The Code (${history.difficulty})</p><p>Berhasil! (+${history.pointsEarned} Poin)</p>`;
                  }
                  historyCard.innerHTML = content;
                  historyList.appendChild(historyCard);
              });
          }
      });

      document.getElementById('close-profile-btn').addEventListener('click', () => {
          screens.profileModal.style.display = 'none';
      });
      
      document.getElementById('save-profile-btn').addEventListener('click', async () => {
          const newDisplayName = document.getElementById('edit-username-input').value.trim();
          if (newDisplayName.length < 3 || newDisplayName.includes(" ")) {
              alert("Nama minimal 3 karakter & tanpa spasi.");
              return;
          }
          showLoading(true, "Menyimpan...");
          // Check for uniqueness before saving
          const usersRef = collection(db, "users");
          const q = query(usersRef, where("displayName", "==", newDisplayName));
          const querySnapshot = await getDocs(q);
          if (!querySnapshot.empty && querySnapshot.docs[0].id !== currentUser.uid) {
              showLoading(false);
              alert("Nama tampilan sudah digunakan oleh pemain lain.");
              return;
          }

          const userDocRef = doc(db, "users", currentUser.uid);
          await updateDoc(userDocRef, { displayName: newDisplayName });
          userData.displayName = newDisplayName;
          usernameDisplay.textContent = newDisplayName;
          showLoading(false);
          alert("Profil berhasil diperbarui!");
      });

      // --- GAME HISTORY SAVING ---
      async function saveQuizResult(title, difficulty, score, total) {
          const pointsEarned = score * 10;
          const historyRef = collection(db, `users/${currentUser.uid}/gameHistory`);
          await addDoc(historyRef, {
              type: 'Kuis', title, difficulty, score, total, pointsEarned,
              timestamp: serverTimestamp()
          });
          
          const userDocRef = doc(db, "users", currentUser.uid);
          await updateDoc(userDocRef, {
              totalPoints: increment(pointsEarned)
          });
          userData.totalPoints = (userData.totalPoints || 0) + pointsEarned;
      }
      async function saveBerkaryaResult(prompt) {
          const historyRef = collection(db, `users/${currentUser.uid}/gameHistory`);
          await addDoc(historyRef, {
              type: 'Berkarya',
              prompt: prompt,
              timestamp: serverTimestamp()
          });
      }
      async function saveFixCodeResult(difficulty, points) {
          await addDoc(collection(db, `users/${currentUser.uid}/gameHistory`), {
              type: 'FixTheCode', difficulty, pointsEarned: points, timestamp: serverTimestamp()
          });
          await updateDoc(doc(db, "users", currentUser.uid), {
              totalPoints: increment(points)
          });
          userData.totalPoints = (userData.totalPoints || 0) + points;
      }

      // --- SCREEN MANAGEMENT ---
      function showScreen(screenKey) {
        Object.values(screens).forEach((s) => {
          if (!s.classList.contains('fixed')) { 
            s.style.display = "none";
          }
        });
        if (screens[screenKey]) {
          screens[screenKey].style.display = "flex";
        }
      }

      function showLoading(show, text = "Memuat...") {
        screens.loading.style.display = show ? "flex" : "none";
        document.getElementById("loading-text").textContent = text;
      }
      
      // --- ADMIN PANEL LOGIC ---
      async function showAdminPanel() {
          showScreen('adminPanel');
          const userListDiv = document.getElementById('admin-user-list');
          userListDiv.innerHTML = '<p class="text-center">Memuat daftar pengguna...</p>';

          try {
              const usersSnapshot = await getDocs(collection(db, "users"));
              userListDiv.innerHTML = '';
              usersSnapshot.forEach(userDoc => {
                  const user = userDoc.data();
                  const userCard = document.createElement('div');
                  userCard.className = 'bg-blue-800 p-3 rounded-lg flex justify-between items-center';
                  userCard.innerHTML = `
                      <div>
                          <p class="font-bold">${user.displayName} <span class="text-xs text-gray-400">(${user.email})</span></p>
                          <p>Poin: <input type="number" value="${user.totalPoints || 0}" class="bg-transparent w-20 points-input text-white" data-uid="${user.uid}"></p>
                      </div>
                      <button class="btn ${user.isBanned ? 'btn-primary' : 'btn-danger'} ban-btn text-xs py-1 px-2" data-uid="${user.uid}" data-banned="${user.isBanned || false}">
                          ${user.isBanned ? 'Unban' : 'Ban'}
                      </button>
                  `;
                  userListDiv.appendChild(userCard);
              });
              
              userListDiv.querySelectorAll('.ban-btn').forEach(btn => {
                  btn.addEventListener('click', async e => {
                      const uid = e.target.dataset.uid;
                      const isBanned = e.target.dataset.banned === 'true';
                      await updateDoc(doc(db, 'users', uid), { isBanned: !isBanned });
                      showAdminPanel();
                  });
              });
              userListDiv.querySelectorAll('.points-input').forEach(input => {
                  input.addEventListener('change', async e => {
                      const uid = e.target.dataset.uid;
                      const newPoints = parseInt(e.target.value, 10);
                      if (!isNaN(newPoints)) {
                          await updateDoc(doc(db, 'users', uid), { totalPoints: newPoints });
                      }
                  });
              });

          } catch (error) {
              console.error("Error fetching users:", error);
              userListDiv.innerHTML = '<p class="text-red-400">Gagal memuat pengguna.</p>';
          }
      }
      
      adminPanelBtn.addEventListener('click', showAdminPanel);

      document.getElementById('send-gift-form').addEventListener('submit', async e => {
          e.preventDefault();
          const uid = document.getElementById('gift-uid').value;
          const points = parseInt(document.getElementById('gift-points').value, 10);
          if (uid && !isNaN(points)) {
              showLoading(true, 'Mengirim hadiah...');
              try {
                  await updateDoc(doc(db, 'users', uid), { totalPoints: increment(points) });
                  alert('Hadiah berhasil dikirim!');
                  document.getElementById('send-gift-form').reset();
              } catch (error) {
                  alert('Gagal mengirim hadiah. Pastikan User ID benar.');
              } finally {
                  showLoading(false);
              }
          }
      });
      
      document.getElementById('create-quiz-form').addEventListener('submit', async e => {
          e.preventDefault();
          const title = document.getElementById('quiz-title').value.trim();
          const id = document.getElementById('quiz-id').value.trim();
          const questionsText = document.getElementById('quiz-questions').value.trim();

          if (!title || !id || !questionsText) {
              alert("Semua field harus diisi.");
              return;
          }

          const questions = [];
          const lines = questionsText.split('\n');
          for (const line of lines) {
              const parts = line.split(';;');
              if (parts.length !== 6) {
                  alert(`Format pertanyaan salah di baris: "${line}". Harus ada 6 bagian dipisah dengan ';;'.`);
                  return;
              }
              questions.push({
                  q: parts[0].trim(),
                  o: [parts[1].trim(), parts[2].trim(), parts[3].trim(), parts[4].trim()],
                  a: parts[5].trim()
              });
          }

          showLoading(true, 'Menyimpan kuis...');
          try {
              await setDoc(doc(db, 'customQuizzes', id), {
                  title,
                  id,
                  questions,
                  createdBy: currentUser.uid,
                  createdAt: serverTimestamp()
              });
              alert('Kuis berhasil disimpan!');
              document.getElementById('create-quiz-form').reset();
          } catch (error) {
              console.error("Error saving custom quiz:", error);
              alert('Gagal menyimpan kuis.');
          } finally {
              showLoading(false);
          }
      });
      
      // --- GLOBAL CHAT LOGIC ---
      document.getElementById('global-chat-btn').addEventListener('click', () => {
          screens.globalChatModal.style.display = 'flex';
          const chatMessages = document.getElementById('chat-messages');
          chatMessages.innerHTML = '<p class="text-center">Memuat chat...</p>';
          
          const chatRef = collection(db, 'globalChat');
          const q = query(chatRef, orderBy('timestamp', 'asc'), limit(100));
          
          unsubscribeChat = onSnapshot(q, (snapshot) => {
              chatMessages.innerHTML = '';
              snapshot.forEach(doc => {
                  const msg = doc.data();
                  const msgElement = document.createElement('div');
                  const isSender = currentUser && msg.senderId === currentUser.uid;
                  msgElement.className = `flex flex-col ${isSender ? 'items-end' : 'items-start'}`;
                  msgElement.innerHTML = `
                      <p class="text-xs text-yellow-300 ${isSender ? 'text-right' : 'text-left'}">${msg.senderName}</p>
                      <div class="p-3 rounded-lg max-w-xs ${isSender ? 'bg-green-600' : 'bg-gray-700'}">${msg.text}</div>
                  `;
                  chatMessages.appendChild(msgElement);
              });
              chatMessages.scrollTop = chatMessages.scrollHeight;
          });
      });

      document.getElementById('close-chat-btn').addEventListener('click', () => {
          if (unsubscribeChat) unsubscribeChat();
          screens.globalChatModal.style.display = 'none';
      });

      document.getElementById('chat-form').addEventListener('submit', async e => {
          e.preventDefault();
          const input = document.getElementById('chat-input');
          const text = input.value.trim();
          if (text) {
              input.value = '';
              await addDoc(collection(db, 'globalChat'), {
                  text: text,
                  senderId: currentUser.uid,
                  senderName: userData.displayName,
                  timestamp: serverTimestamp()
              });
          }
      });

      // --- GAME LAUNCHERS & EVENT LISTENERS ---
      const sastraPrompts = [
        "Cinta yang bertepuk sebelah tangan.", "Sebuah penyesalan di tengah hujan.",
        "Harapan terakhir seorang pejuang.", "Keindahan dalam kesendirian.",
        "Ketika teknologi menguasai perasaan.", "Senja di kota yang tak pernah tidur.",
      ];

      document.getElementById("start-perang-sastra").addEventListener("click", () => showScreen("perangSastraLobby"));
      document.getElementById("start-menguji-literasi").addEventListener("click", () => showQuizModeModal("literasi", "Uji Literasi"));
      document.getElementById("start-kuis-sosial").addEventListener("click", () => showQuizModeModal("sosial", "Kuis Sosial"));
      document.getElementById("start-berkarya").addEventListener("click", startBerkarya);
      document.getElementById("start-fix-code").addEventListener("click", showLanguageSelectionModal);
      document.getElementById("start-custom-quiz").addEventListener("click", () => showQuizModeModal('custom', 'Kuis Kustom'));
      
      async function showCustomQuizLobby(isSinglePlayer) {
          showScreen('customQuizLobby');
          const listDiv = document.getElementById('custom-quiz-list');
          listDiv.innerHTML = '<p class="text-center">Memuat daftar kuis...</p>';
          
          try {
              const querySnapshot = await getDocs(collection(db, 'customQuizzes'));
              if (querySnapshot.empty) {
                  listDiv.innerHTML = '<p class="text-center">Belum ada kuis kustom yang dibuat.</p>';
                  return;
              }
              listDiv.innerHTML = '';
              querySnapshot.forEach(docSnap => {
                  const quiz = docSnap.data();
                  const quizCard = document.createElement('button');
                  quizCard.className = 'w-full btn btn-secondary';
                  quizCard.textContent = quiz.title;
                  quizCard.addEventListener('click', () => {
                      if (isSinglePlayer) {
                          startQuiz('custom', quiz.id);
                      } else {
                          createQuizRoom(quiz.questions, quiz.title);
                      }
                  });
                  listDiv.appendChild(quizCard);
              });
          } catch (error) {
              console.error("Error fetching custom quizzes:", error);
              listDiv.innerHTML = '<p class="text-center text-red-400">Gagal memuat kuis.</p>';
          }
      }
      
      async function renderLeaderboard(containerId) {
          const listContainer = document.getElementById(containerId);
          if (!listContainer) return;
          listContainer.innerHTML = '<div class="flex justify-center items-center"><div id="loading-spinner"></div></div>';

          try {
              const usersRef = collection(db, "users");
              const q = query(usersRef, orderBy("totalPoints", "desc"), limit(10));
              const querySnapshot = await getDocs(q);
              
              if (querySnapshot.empty) {
                  listContainer.innerHTML = '<p class="text-center font-body">Belum ada pemain di peringkat.</p>';
                  return;
              }

              listContainer.innerHTML = '';
              let rank = 1;
              querySnapshot.forEach(docSnap => {
                  const playerData = docSnap.data();
                  const isCurrentUser = currentUser && playerData.uid === currentUser.uid;
                  const rankItem = document.createElement('div');
                  rankItem.className = `flex items-center justify-between p-3 rounded-lg font-body ${isCurrentUser ? 'bg-yellow-400 text-black' : 'bg-blue-800'}`;
                  rankItem.innerHTML = `
                      <div class="flex items-center">
                          <span class="font-bold text-lg w-8">${rank}.</span>
                          <span class="font-semibold">${playerData.displayName}</span>
                      </div>
                      <span class="font-bold text-lg">${playerData.totalPoints || 0}</span>
                  `;
                  listContainer.appendChild(rankItem);
                  rank++;
              });
          } catch (error) {
              console.error("Error fetching leaderboard:", error);
              listContainer.innerHTML = '<p class="text-center text-red-400 font-body">Gagal memuat peringkat.</p>';
          }
      }

      // --- UNIVERSAL SELECTION MODALS ---
      function showLevelSelectionModal(gameType) {
          const modal = screens.levelSelection;
          modal.dataset.gameType = gameType;
          document.getElementById('level-title').textContent = `Pilih Level`;
          modal.style.display = 'flex';
      }
      
      function showLanguageSelectionModal() {
          screens.languageSelection.style.display = 'flex';
      }

      document.querySelectorAll(".level-btn").forEach((btn) => {
        btn.addEventListener("click", async (e) => {
          const level = e.target.dataset.level;
          const gameType = screens.levelSelection.dataset.gameType;
          screens.levelSelection.style.display = "none";
          
          if (gameType === 'quiz-sp') {
              startQuiz(currentQuizType, level);
          } else if (gameType === 'quiz-mp') {
              const questions = await generateQuizQuestions(currentQuizType, level);
              if (questions) {
                  createQuizRoom(questions, currentQuizInfo.title);
              }
          } else if (gameType === 'fix-code') {
              startFixTheCode(selectedCodeLanguage, level);
          } else if (gameType === 'perang-sastra-sp') {
              startPerangSastraSP(level);
          }
        });
      });
      document.getElementById("back-from-level").addEventListener("click", () => {
          screens.levelSelection.style.display = 'none';
      });
      
      document.querySelectorAll(".lang-btn").forEach(btn => {
          btn.addEventListener('click', e => {
              selectedCodeLanguage = e.target.dataset.lang;
              screens.languageSelection.style.display = 'none';
              showLevelSelectionModal('fix-code');
          });
      });
      document.getElementById("back-from-lang").addEventListener("click", () => {
          screens.languageSelection.style.display = 'none';
      });
      
      // --- KUIS LOGIC (MODIFIED FOR CUSTOM & MULTIPLAYER) ---
      async function generateQuizQuestions(type, difficulty) {
        showLoading(true, `AI sedang membuat soal ${difficulty}...`);
        const questionCount = { mudah: 5, sedang: 7, sulit: 10 };
        const topic = type === "literasi" ? "literasi bahasa Indonesia (sinonim, antonim, makna kata)" : "pengetahuan sosial umum tentang Indonesia (sejarah, geografi, budaya)";
        const aiPrompt = `Buatkan ${questionCount[difficulty]} soal kuis pilihan ganda tentang ${topic} tingkat ${difficulty}. Pastikan jawabannya ada di dalam opsi.`;
        const schema = { type: "ARRAY", items: { type: "OBJECT", properties: { q: { type: "STRING" }, o: { type: "ARRAY", items: { type: "STRING" } }, a: { type: "STRING" } }, required: ["q", "o", "a"] } };

        try {
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;
          const payload = { contents: [{ role: "user", parts: [{ text: aiPrompt }] }], generationConfig: { responseMimeType: "application/json", responseSchema: schema } };
          const response = await fetch(apiUrl, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
          if (!response.ok) throw new Error(`API call failed: ${response.statusText}`);
          const result = await response.json();
          return JSON.parse(result.candidates[0].content.parts[0].text);
        } catch (error) {
          console.error("Error generating quiz:", error);
          alert("Maaf, AI gagal membuat soal. Pastikan Anda sudah memasukkan Gemini API Key.");
          return null;
        } finally {
          showLoading(false);
        }
      }

      async function startQuiz(type, idOrDifficulty) {
        let questions;
        let title;

        if (type === 'custom') {
            showLoading(true, 'Memuat kuis kustom...');
            const quizDoc = await getDoc(doc(db, 'customQuizzes', idOrDifficulty));
            if (quizDoc.exists()) {
                const quizData = quizDoc.data();
                questions = quizData.questions;
                title = quizData.title;
            } else {
                alert("Kuis tidak ditemukan!");
                showLoading(false);
                return;
            }
            showLoading(false);
        } else {
            questions = await generateQuizQuestions(type, idOrDifficulty);
            title = type === "literasi" ? "Uji Literasi" : "Kuis Sosial";
        }

        if (!questions || questions.length === 0) {
          showScreen("mainMenu");
          return;
        }

        let currentQ = 0;
        let score = 0;
        const timePerQuestion = 20;

        async function renderQuiz() {
          if (quizTimerId) clearInterval(quizTimerId);

          if (currentQ >= questions.length) {
            showLoading(true, "Menyimpan hasil...");
            await saveQuizResult(title, type === 'custom' ? 'kustom' : idOrDifficulty, score, questions.length);
            showLoading(false);
            gameContent.innerHTML = `
                <div class="card non-interactive rounded-lg p-8 text-center w-full max-w-lg mx-auto">
                    <h2 class="text-4xl text-shadow text-white mb-4">Kuis Selesai!</h2>
                    <p class="text-2xl font-body">Skor Akhir:</p>
                    <p class="text-6xl my-4 text-white">${score} / ${questions.length}</p>
                    <p class="text-xl font-bold text-yellow-300">+${score * 10} Poin!</p>
                    <button class="back-to-menu-btn mt-2 btn btn-secondary">Menu Utama</button>
                </div>`;
            gameContent.querySelector('.back-to-menu-btn').addEventListener('click', exitToMainMenu);
            return;
          }
          const q = questions[currentQ];
          let timeLeft = timePerQuestion;
          
          gameContent.innerHTML = `
              <div class="card non-interactive rounded-lg p-8 w-full max-w-3xl mx-auto">
                  <div class="w-full progress-bar-container h-4 mb-4">
                      <div id="quiz-timer-bar" class="progress-bar" style="width: 100%"></div>
                  </div>
                  <div class="flex justify-between items-center mb-4">
                      <h2 class="text-2xl">${title}</h2>
                      <p class="text-lg bg-black text-white px-3 py-1 rounded-md">Poin: ${score * 10}</p>
                  </div>
                  <p class="text-xl font-body font-semibold mb-6 min-h-[6rem] flex items-center">${q.q}</p>
                  <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      ${q.o.map((opt) => `<button class="option-btn w-full btn btn-secondary p-4 text-left font-body">${opt}</button>`).join("")}
                  </div>
              </div>
              <button class="back-to-menu-btn mt-8 text-yellow-300 hover:text-yellow-100 font-semibold">&larr; Keluar dari Kuis</button>
              `;
          
          gameContent.querySelector('.back-to-menu-btn').addEventListener('click', exitToMainMenu);
          
          const timerBar = document.getElementById('quiz-timer-bar');
          quizTimerId = setInterval(() => {
              timeLeft--;
              timerBar.style.width = `${(timeLeft / timePerQuestion) * 100}%`;
              if (timeLeft <= 0) {
                  handleTimeUp();
              }
          }, 1000);

          document.querySelectorAll(".option-btn").forEach((btn) => btn.addEventListener("click", (e) => checkAnswer(e.target)));
        }

        function handleTimeUp() {
            clearInterval(quizTimerId);
            const correctAnswer = questions[currentQ].a;
            document.querySelectorAll(".option-btn").forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === correctAnswer) {
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('bg-green-500');
                }
            });
            setTimeout(() => {
                currentQ++;
                renderQuiz();
            }, 2000);
        }

        function checkAnswer(selectedButton) {
          clearInterval(quizTimerId);
          const selectedAnswer = selectedButton.textContent;
          const correctAnswer = questions[currentQ].a;
          document.querySelectorAll(".option-btn").forEach((btn) => {
            btn.disabled = true;
            if (btn.textContent === correctAnswer) {
              btn.classList.remove("btn-secondary");
              btn.classList.add("bg-green-500");
            }
          });
          if (selectedAnswer === correctAnswer) {
            score++;
            selectedButton.classList.remove("btn-secondary");
            selectedButton.classList.add("bg-green-500");
          } else {
            selectedButton.classList.remove("btn-secondary");
            selectedButton.classList.add("bg-red-500");
          }
          setTimeout(() => {
            currentQ++;
            renderQuiz();
          }, 1500);
        }

        showScreen("gameContainer");
        renderQuiz();
      }

      // --- BERKARYA SENDIRI LOGIC ---
      function startBerkarya() {
        // ... (Fungsi ini tetap sama seperti versi sebelumnya)
      }
      
      // --- PERANG SASTRA LOGIC (BOTH SP & MP) ---
      // ... (Semua fungsi Perang Sastra tetap sama seperti versi sebelumnya)
      
      // --- Fix The Code ---
      // ... (Semua fungsi Fix the Code tetap sama seperti versi sebelumnya)
      
      // --- UNIVERSAL EXIT BUTTON LOGIC ---
      function exitToMainMenu() {
          if (unsubscribeGameListener) {
              unsubscribeGameListener();
              unsubscribeGameListener = null;
          }
          if (unsubscribeChat) {
              unsubscribeChat();
              unsubscribeChat = null;
          }
          if (quizTimerId) {
              clearInterval(quizTimerId);
              quizTimerId = null;
          }
          gameContent.innerHTML = "";
          showScreen("mainMenu");
          renderLeaderboard('leaderboard-list');
      }

      // Initial setup for static back buttons
      document.querySelectorAll(".back-to-menu-btn").forEach(btn => {
          btn.addEventListener("click", exitToMainMenu);
      });
    </script>
  </body>
</html>
